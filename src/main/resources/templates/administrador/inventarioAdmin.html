<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GestiÃ³n de Inventario - MotorEntix</title>
  <link rel="stylesheet" th:href="@{/css/panel.admin.css}">
</head>

<body>
  <header>
    <div class="logo">
      <h1>MotorEntix</h1>
    </div>
    <div class="user-info">
      <div class="user-menu">
        <button type="button" class="user-menu-toggle">
          <span class="user-name-label" th:if="${usuario != null}" th:text="${usuario.nombre} + ' ' + ${usuario.apellido}">Administrador</span>
          <span class="user-name-label" th:unless="${usuario != null}">Administrador</span>
          <div class="user-avatar" th:if="${usuario != null}" th:text="${usuario.nombre.substring(0, 1)}">A</div>
          <div class="user-avatar" th:unless="${usuario != null}">A</div>
          <span class="user-menu-arrow">â–¾</span>
        </button>
        <div class="user-menu-dropdown">
          <a th:href="@{/admin/mi-perfil}" class="user-menu-item">
            <span>ğŸ‘¤ Mi perfil</span>
          </a>
          <a th:href="@{/editar-perfil}" class="user-menu-item">
            <span>âœï¸ Editar perfil</span>
          </a>
          <div class="user-menu-divider"></div>
          <a th:href="@{/logout}" class="user-menu-item user-menu-item-danger">
            <span>ğŸšª Cerrar sesiÃ³n</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <nav class="sidebar">
      <ul class="sidebar-menu">
        <li class="menu-item">
          <a th:href="@{/admin/mi-perfil}" style="text-decoration: none; color: inherit;">
            <span>ğŸ‘¤</span> Mi Perfil
          </a>
        </li>
        <li class="menu-item">
          <a th:href="@{/admin/vehiculos}" style="text-decoration: none; color: inherit;">
            <span>ğŸš—</span> VehÃ­culos
          </a>
        </li>
        <li class="menu-item active">
          <a th:href="@{/admin/inventario}" style="text-decoration: none; color: inherit;">
            <span>ğŸ“¦</span> Inventario
          </a>
        </li>
        <li class="menu-item">
          <a th:href="@{/admin/proveedor}" style="text-decoration: none; color: inherit;">
            <span>ğŸ¢</span> Proveedor
          </a>
        </li>
        <li class="menu-item">
          <a th:href="@{/admin/clientes}" style="text-decoration: none; color: inherit;">
            <span>ğŸ‘¥</span> Clientes
          </a>
        </li>
        <li class="menu-item">
          <a th:href="@{/admin/reservas}" style="text-decoration: none; color: inherit;">
            <span>ğŸ“‹</span> Reservas
          </a>
        </li>
        <li class="menu-item">
          <a th:href="@{/admin/pagos}" style="text-decoration: none; color: inherit;">
            <span>ğŸ’°</span> Pagos
          </a>
        </li>
      </ul>
    </nav>

    <main class="main-content">
      <div class="page-header">
        <h2 class="page-title" th:text="${editMode} ? 'Editar Producto de Inventario' : 'GestiÃ³n de Inventario'"></h2>
      </div>

      <div class="inventory-page">
        <section class="inventory-card">
          <div class="inventory-header">
            <div>
              <h3 class="inventory-header-title">
                <span class="icon">ğŸ“¦</span>
                <span th:text="${editMode} ? 'Editar producto de inventario' : 'Agregar nuevo producto'"></span>
              </h3>
              <p class="inventory-subtitle">
                Completa los campos para registrar o actualizar un producto.
              </p>
            </div>
          </div>

          <form th:action="@{/admin/inventario/guardar}" method="post" th:object="${inventario}"
            class="inventory-form">
          <input type="hidden" th:field="*{id}">

          <div class="form-row">
            <div class="form-group">
              <label for="nombre">Nombre del producto</label>
              <input type="text" id="nombre" th:field="*{nombre}" required class="search-input">
            </div>

            <div class="form-group">
              <label for="cantidad">Cantidad en stock</label>
              <input type="number" id="cantidad" th:field="*{cantidad}" min="0" required class="search-input">
            </div>

            <div class="form-group">
              <label for="precioUnitario">Precio unitario</label>
              <input type="number" id="precioUnitario" th:field="*{precioUnitario}" min="0" step="0.01"
                class="search-input">
            </div>

			<div class="form-group">
			  <label for="proveedorSelect">Proveedor</label>
			  <select id="proveedorSelect" th:field="*{proveedor.id}" required class="search-input">
				<option value="" disabled th:if="${inventario.proveedor} == null" selected>Seleccione un proveedor</option>
				<option th:each="prov : ${proveedores}" th:value="${prov.id}" th:text="${prov.nombre}"></option>
			  </select>
			</div>
          </div>

          <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center;">
            <button type="submit" class="btn btn-primary">
              <span th:text="${editMode} ? 'Actualizar producto' : 'Agregar producto'"></span>
            </button>
            <a th:if="${editMode}" th:href="@{/admin/inventario/lista}" class="btn btn-clear">Cancelar ediciÃ³n</a>
          </div>

          <p class="inventory-meta">
            <span>Campos marcados son obligatorios.</span>
            <span class="badge" th:text="${inventarios != null ? inventarios.size() : 0} + ' productos registrados'"></span>
          </p>
        </form>
        </section>

        <section class="inventory-card">
          <div class="inventory-table-title">
            <h3 class="table-title">Productos en Inventario</h3>
            <small th:text="${inventarios != null ? inventarios.size() : 0} + ' Ã­tems'">0 Ã­tems</small>
          </div>

          <div class="table-wrapper">
            <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="item : ${inventarios}">
                <td th:text="${item.id}"></td>
                <td th:text="${item.nombre}"></td>
                <td th:text="${item.cantidad}"></td>
                <td th:text="${item.precioUnitario}"></td>
                <td>
                  <a th:href="@{/admin/inventario/editar/{id}(id=${item.id})}" class="btn-action btn-edit">Editar</a>
                  <form th:action="@{/admin/inventario/eliminar/{id}(id=${item.id})}" method="post"
                    style="display:inline;">
                    <button type="submit" class="btn-action btn-delete"
                      onclick="return confirm('Â¿Seguro que deseas eliminar este producto?');">Eliminar</button>
                  </form>
                </td>
              </tr>

              <tr th:if="${inventarios == null or inventarios.empty}">
                <td colspan="5" class="inventory-empty">
                  <span>
                    <span>ğŸ“</span>
                    <span>No hay productos en el inventario. Agrega el primero usando el formulario superior.</span>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
		// Dropdown de usuario en header (todas las instancias .user-menu de la pÃ¡gina)
		document.addEventListener('DOMContentLoaded', function () {
			const userMenus = document.querySelectorAll('.user-menu');
			if (!userMenus.length) return;

			function closeAllMenus() {
				userMenus.forEach(m => m.classList.remove('open'));
			}

			userMenus.forEach(function (userMenu) {
				const toggle = userMenu.querySelector('.user-menu-toggle');
				if (!toggle) return;

				toggle.addEventListener('click', function (event) {
					event.stopPropagation();
					const isOpen = userMenu.classList.contains('open');
					closeAllMenus();
					if (!isOpen) {
						userMenu.classList.add('open');
					}
				});
			});

			document.addEventListener('click', function () {
				closeAllMenus();
			});
		});
	</script>
</body>

</html>
